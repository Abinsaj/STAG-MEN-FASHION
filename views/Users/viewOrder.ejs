<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>STAG MEN FASHION</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/admin/assets/img/logo.png" />

    <!-- fontawesome icons -->
    <script src="https://kit.fontawesome.com/d93ba016b2.js" crossorigin="anonymous"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="/public/js/jquery-3.3.1.min.js"></script>
    <!-- magic zoom Plugins -->
    <link rel="stylesheet" href="/user/magiczoomplus/magiczoomplus.css">
    <script src="/public/magiczoomplus/magiczoomplus.js"></script>

    <!-- bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>

    <!-- SweetAlert dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/public/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/public/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/public/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="/public/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="/public/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/public/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/public/css/style.css" type="text/css">
    <link rel="stylesheet" href="/public/assets/css/maind134.css?v=3.4">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- Boxicons CDN Link -->

    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <!-- <link href="/public/adminassets/css/main.css" rel="stylesheet" type="text/css" /> -->
</head>



<!-- Header Section User not logged In -->



<!-- Offcanvas Menu Begin -->
<div class="offcanvas-menu-overlay"></div>
<div class="offcanvas-menu-wrapper">
    <div class="offcanvas__option">
        <div class="offcanvas__links">
            <% if(userID){%>
                <a href="/logout">Log out</a>
                <%} else { %>
                    <a href="login">Log in</a>
                    <%}%>

        </div>
        <div class="offcanvas__top__hover">
            <%if(userID){%>
                <a href="/profile">
                    <span>Profile <i class="arrow_carrot"></i></span>
                </a>
                <%} else {%>
                    <a href="login"></a>
                    <% } %>
        </div>
    </div>
    <div class="offcanvas__nav__option">
        <a href="#" class="search-switch"><img src="/public/img/icon/search.png" alt=""></a>
        <a href="#"><img src="/public/img/icon/heart.png" alt=""></a>
        <a href="/cart"><img src="/public/img/icon/cart.png" alt=""> <span>0</span></a>
        <div class="price"></div>
    </div>
    <div id="mobile-menu-wrap"></div>
    <div class="offcanvas__text">
        <p>Free shipping, 30-day return or refund guarantee.</p>
    </div>
</div>
<!-- Offcanvas Menu End -->

<!-- Header Section Begin -->
<header class="header">
    <div class="header__top">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-7">
                    <div class="header__top__left">
                        <p>Free shipping, 30-day return or refund guarantee.</p>
                    </div>
                </div>
                <div class="col-lg-6 col-md-5">
                    <div class="header__top__right">
                        <div class="header__top__links">
                            <% if(userID){%>
                                <a href="/logout">Log out</a>
                                <%} else { %>
                                    <a href="login">Log in</a>
                                    <%}%>

                        </div>
                        <div class="header__top__hover">
                            <%if(userID){%>
                                <a href="/profile">
                                    <span>Profile <i class="arrow_carrot"></i></span>
                                </a>
                                <%} else {%>
                                    <a href="login"></a>
                                    <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-2 col-md-2">
                <div class="brand-wrap">
                    <a href="./index.html"><img src="/public/adminassets/imgs/theme/logo.png" alt=""></a>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <nav class="header__menu mobile-menu">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li class=""><a href="/shop">Shop</a></li>
                        <li><a href="#">Pages</a>
                        </li>

                    </ul>
                </nav>
            </div>
            <div class="col-lg-3 col-md-3">
                <div class="header__nav__option">
                    <a href="#" class="search-switch"><img src="/public/img/icon/search.png" alt=""></a>
                    <a href="/wishlist"><img src="/public/img/icon/heart.png" alt=""></a>
                    <a href="/cart"><img src="/public/img/icon/cart.png" alt=""> <span></span></a>
                    <div class="price"></div>
                </div>
            </div>
        </div>
        <div class="canvas__open"><i class="fa fa-bars"></i></div>
    </div>
</header>

<section class="mt-50 mb-50">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table shopping-summery text-center clean">
                        <thead>
                            <tr class="main-heading">
                                <th scope="col">Image</th>
                                <th scope="col">Name</th>
                                <th scope="col">Coupon</th>
                             
                                <th scope="col">Product Price</th>
                                <th scope="col">Quantity</th>
                                
                                <th scope="col">Status</th>

                            </tr>
                        </thead>
                        <tbody>
                            <% order.forEach(element=>{ %>
                                <% element.products.forEach(el=>{%>


                                    <tr>
                                        <td class="image product-thumbnail"><img
                                                src="/uploads/<%= el.product.image[0] %>" alt="#"></td>
                                        <td class="product-des product-name">
                                            <h5 class="product-name"><a href="shop-product-right.html">
                                                    <%= el.product.name %>
                                                </a></h5>
                                        </td>

                                        <% if (element.coupon=="" ) { %>
                                            <td class="text-center" data-title="Stock">
                                                <div class="">
                                                    <a href="#" class="qty-down"></a>
                                                    <span class="qty-val">No Coupon</span>
                                                    <a href="#" class="qty-up"></a>
                                                </div>
                                            </td>

                                           
                                            <% } else { %>
                                                <td class="text-center" data-title="Stock">
                                                    <div class="">
                                                        <a href="#" class="qty-down"></a>
                                                        <span class="qty-val">
                                                            <%= element.coupon %>
                                                        </span>
                                                        <a href="#" class="qty-up"></a>
                                                    </div>
                                                </td>

                                              
                                                <% } %>

                                                    <td class="text-center" data-title="Stock">
                                                        <div class="">
                                                            <a href="#" class="qty-down"></a>
                                                            <span class="qty-val">
                                                                <%= el.product.price.salesPrice %>
                                                            </span>
                                                            <a href="#" class="qty-up"></a>
                                                        </div>
                                                    </td>

                                                    <td class="text-center" data-title="Stock">
                                                        <div class="">
                                                            <a href="#" class="qty-down"></a>
                                                            <span class="qty-val">
                                                                <%= el.quantity %>
                                                            </span>
                                                            <a href="#" class="qty-up"></a>
                                                        </div>
                                                    </td>
                                                    <!-- <td class="text-center" data-title="Stock">
                                                        <div class="">
                                                            <a href="#" class="qty-down"></a>
                                                            <span class="qty-val">
                                                                
                                                            </span>
                                                            <a href="#" class="qty-up"></a>
                                                        </div>
                                                    </td> -->
                                                    <%if(element.status=="confirmed"){%>
                                                        <td class="text-right" data-title="Cart">
                                                            <span class="badge bg-success">
                                                                <%= element.status %>
                                                            </span>
                                                        </td>
                                                        <%}else {%>
                                                            <td class="text-right" data-title="Cart">
                                                                <span class="badge bg-warning">
                                                                    <%= element.status %>
                                                                </span>
                                                            </td>
                                                            <%}%>

                                                                <style>
                                                                    .badge {

                                                                        font-size: 16px;
                                                                        /* Adjust the font size as needed */
                                                                        padding: 9px 13px;
                                                                        /* Adjust the padding as needed */
                                                                    }
                                                                </style>


                                    </tr>
                                    <%})%>

                                        <% }) %>

                        </tbody>
                    </table>
                </div>
                <% order.forEach(element=>{%>
                    <div class="cart-action text-end">
                        <% if(element.status=="Delivered" ){ %>
                            <button onclick="returnOrder(`<%= element._id %>`)" class="btn  mr-10 mb-sm-15"><i
                                    class="fi-rs-cross mr-10"></i>Return Order</button>
                            <% } else if(element.status=="Cancelled" || element.status=="Returned" ){ %>
                                <button onclick="back()" class="btn  mr-10 mb-sm-15"><i
                                        class="fi-rs-cross mr-10"></i>Back</button>
                                <%} else if(element.status=="Return Processing" ){%>
                                    <button onclick="cancelReturn(`<%= element._id %>`)" class="btn  mr-10 mb-sm-15"><i
                                            class="fi-rs-cross mr-10"></i>Cancel Return</button>
                                    <% } else { %>
                                        <button onclick="cancelOrder(`<%= element._id %>`)"
                                            class="btn  mr-10 mb-sm-15"><i class="fi-rs-cross mr-10"></i>Cancel
                                            Order</button>
                                        <a href="/shop"><button class="btn "><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Continue Shopping</button></a>
                                        <% } %>
                    </div>
                    <%} )%>
                        <div class="divider center_icon mt-50 mb-50"><i class="fi-rs-fingerprint"></i></div>

                        <div class="col-lg-6 col-md-12">
                            <div class="border p-md-4 p-30 border-radius cart-totals">
                                <div class="heading_s1 mb-3">
                                    <h4></h4>
                                </div>
                                <div class="table-responsive">
                                    <% order.forEach(element=>{%>
                                        <table class="table">

                                            <tbody>
                                                <tr>
                                                    <td class="cart_total_label">Sub Total</td>
                                                    <td class=""><span class="font-lg fw-900 text-brand">
                                                            <%= element.totalamount %>
                                                        </span></td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Discount</td>
                                                    <td class="cart_total_amount"> <i class="ti-gift mr-5"></i><%= element.discount %>%</td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Total</td>
                                                    <td class=""><strong><span class="font-xl fw-900 text-brand">
                                                                <%= element.totalamount %>
                                                            </span></strong></td>
                                                </tr>

                                            </tbody>

                                        </table>
                                        <% if (element.status=="Delivered" ) { %>
                                            <a href="/invoice?id=<%= element._id %>"><button
                                                    class="btn  mr-10 mb-sm-15">Download Invoice</button></a>
                                            <% } %>
                                                <% if (element.status=="Payment Failed" ) { %>
                                                    <input type="hidden" id="oid" value="<%= element._id %>">
                                                    <button onclick="placeOrder(`<%= element._id %>`)"
                                                        class="btn btn-fill-out btn-block mt-30">Pay
                                                        Again</button>
                                                    <% } %>
                                                        <%} )%>
                                </div>

                            </div>
                        </div>
            </div>
        </div>
    </div>
</section>

<div class="containerabove"></div>
<!-- Footer Section Begin -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="footer__about">
                    <div class="footer__logo">
                        <a href="#"><img src="/public/img/footer-logo.png" alt=""></a>
                    </div>
                    <p>The customer is at the heart of our unique business model, which includes design.</p>
                    <a href="#"><img src="/public/img/payment.png" alt=""></a>
                </div>
            </div>
            <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
                <div class="footer__widget">
                    <h6>Shopping</h6>
                    <ul>
                        <li><a href="#">Clothing Store</a></li>
                        <li><a href="#">Trending Shoes</a></li>
                        <li><a href="#">Accessories</a></li>
                        <li><a href="#">Sale</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-2 col-md-3 col-sm-6">
                <div class="footer__widget">
                    <h6>Shopping</h6>
                    <ul>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Payment Methods</a></li>
                        <li><a href="#">Delivary</a></li>
                        <li><a href="#">Return & Exchanges</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
                <div class="footer__widget">
                    <h6>NewLetter</h6>
                    <div class="footer__newslatter">
                        <p>Be the first to know about new arrivals, look books, sales & promos!</p>
                        <form action="#">
                            <input type="text" placeholder="Your email">
                            <button type="submit"><span class="icon_mail_alt"></span></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="footer__copyright__text">
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    <p>Copyright ©
                        <script>
                            document.write(new Date().getFullYear());
                        </script>2020
                        All rights reserved | This template is made with <i class="fa fa-heart-o"
                            aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                    </p>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- Footer Section End -->

<!-- Search Begin -->
<div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch">+</div>
        <form class="search-model-form">
            <input type="text" id="search-input" placeholder="Search here.....">
        </form>
    </div>
</div>
<!-- Search End -->
<script>
    function cancelOrder(orderID) {
        console.log('orderid:' + orderID);
        fetch('/cancelorder', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                orderID
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                }
            });
    }

    function back() {
        window.location.href = '/orders'
    }

    function returnOrder(orderID) {
        Swal.fire({
            title: 'Are you sure?',
            text: 'Are you sure, you want to return the product ',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, change it!',
            cancelButtonText: 'No, cancel!',
        })
            .then((result) => {
                if (result.isConfirmed) {
                    fetch('/return', {
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ orderID })
                    })
                        .then(response => response.json())
                        .then((data) => {
                            if (data.success) {
                                Swal.fire({
                                    title: 'Status has changed',
                                    text: 'The status has changed successfully',
                                    icon: 'success'
                                })
                                    .then(() => {
                                        window.location.href = "/orders"
                                    })
                            }
                        })
                }
            })
    }

    function cancelReturn(orderID) {
        fetch('/cancelreturn', {
            method: 'post',
            headers: {
                'Content-type': 'Application/json'
            },
            body: JSON.stringify({ orderID })
        })
            .then(response => response.json())
            .then((data) => {
                if (data.success) {
                    window.location.href = "/orders"
                }
            })
    }

    function placeOrder(id) {
        fetch('/payagain', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id })
        })
            .then(response => response.json())
            .then(data => {
                const parsedAmount = parseInt(data.orderID.amount)
                const options = {
                    "key": "rzp_test_lTepvaZWAfuQBF", // Enter the Key ID generated from the Dashboard
                    "amount": 1000000, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    "currency": "INR",
                    "name": "STAG MEN FASHION",
                    "description": "Test Transaction",
                    "image": "https://example.com/your_logo",
                    "order_id": data.orderID.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                    "handler": function (response) {
                        // alert(response.razorpay_payment_id);
                        // alert(response.razorpay_order_id);
                        // alert(response.razorpay_signature)
                        verify(response, data.orderID.id,)
                    },
                    "prefill": {
                        "name": "Gaurav Kumar",
                        "email": "gaurav.kumar@example.com",
                        "contact": "9000090000"
                    },
                    "notes": {
                        "address": "Razorpay Corporate Office"
                    },
                    "theme": {
                        "color": "#3399cc"
                    }
                }
                var rzp = new Razorpay(options);
                rzp.open();


            })

    }

    function verify(response, orderId) {
        const orderid = document.getElementById('oid').value
        fetch('/successpayment', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                response,
                orderId,
                orderid
            })
        })
        .then(response=>response.json())
        .then((data)=>{
            if(data.success){
                window.location.href = "/orders"
            }
        })

    }

</script>


<!-- Js Plugins -->

<script src="/user/js/bootstrap.min.js"></script>
<script src="/user/js/jquery.nice-select.min.js"></script>
<script src="/user/js/jquery.nicescroll.min.js"></script>
<script src="/user/js/jquery.magnific-popup.min.js"></script>
<script src="/user/js/jquery.countdown.min.js"></script>
<script src="/user/js/jquery.slicknav.js"></script>
<script src="/user/js/mixitup.min.js"></script>
<script src="/user/js/owl.carousel.min.js"></script>
<script src="/user/js/main.js"></script>
</body>

</html>